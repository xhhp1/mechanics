<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>๐ุงูุชูุงุฑูุฑ ู ุงููุณููุงุช ุงูููุฏุงููุฉ๐</title>
  <style>
    body {
      font-family: Tahoma, Arial, sans-serif;
      background: #e6c200;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #e6c200;
    }

    .section-block {
      margin-bottom: 15px;
      padding: 10px;
      background: #1b1b1b;
      border: 1px solid #1b1b1b;
      border-radius: 6px;
    }

    .group-title {
      font-weight: bold;
      margin-bottom: 6px;
    }

    .units-list {
      margin-bottom: 6px;
    }

    /* === Yellow buttons === */
    button {
      background-color: #FFD700;   /* Gold/Yellow */
      color: #1b1b1b;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    button:hover {
      background-color: #e6c200;
    }

    .add-unit-btn {
      margin-top: 6px;
    }

    .remove-btn {
      background-color: #FFD700;
      color: ##1b1b1b;
      border: none;
      padding: 2px 8px;
      border-radius: 50%;
      margin-right: 5px;
      font-size: 14px;
      cursor: pointer;
    }
    .remove-btn:hover {
      background-color: #e6c200;
    }

    .unit-row {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-bottom: 4px;
    }

    .unit-prefix, .unit-code {
      padding: 4px;
    }

    .report-output {
      background: #1b1b1b;
      color: #e6c200;
      padding: 10px;
      border-radius: 6px;
      white-space: pre-wrap;
    }
  </style>
</head>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>๐ ูุณููุงุช ูุชูุงุฑูุฑ ุงูุนูููุงุช ๐</title>
<style>
  body {
    background: url("https://raw.githubusercontent.com/xhhp1/mechanics/main/images/mechan.png") no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    font-family: Arial, sans-serif;
    color: white;
    text-align: center;
  }
  h2 {
    margin-top: 20px;
  }
  input, select, button {
    margin: 10px;
    padding: 8px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
  }

  /* Toggle Buttons */
  .toggle-buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    justify-content: center;
  }
  .toggle-buttons button {
    padding: 12px 20px;
    font-size: 16px;
    font-weight: bold;
    background: #e0ca51;
    color: #111;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
  }
  .toggle-buttons .report-btn {
    padding: 12px 20px;
    font-size: 16px;
    font-weight: bold;
    background: #e0ca51;
    color: #111;
    border-radius: 8px;
    text-decoration: none;
    display: inline-block;
    transition: 0.3s;
  }
  .toggle-buttons .report-btn:hover {
    background: #c6b142;
  }
  .toggle-buttons button.active {
    background: #c6b142;
  }

  /* Containers */
  .container {
    background-color: #1b1b1b;
    padding: 20px;
    border-radius: 10px;
    width: 400px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    display: none;
    margin: 0 auto;
  }
  .container.active {
    display: block;
  }

  h1 { text-align: center; margin: 0 0 8px; }
  h2 { text-align: center; font-size: 0.95rem; margin: 0 0 12px; }
  input, select {
    width: 100%;
    padding: 8px 10px;
    margin: 6px 0;
    border-radius: 6px;
    border: none;
    box-sizing: border-box;
    background: #2b2b2b;
    color: #e0ca51;
    font-size: 14px;
  }
  label { display: block; font-size: 14px; margin: 6px 0; }

  /* Center Buttons */
  .button-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    margin-top: 15px;
  }
  .generate, .copy-btn {
    display: inline-block;
    width: auto;
    padding: 12px 24px;
    border-radius: 6px;
    background: #e0ca51;
    color: #111;
    font-weight: 700;
    cursor: pointer;
    transition: 0.3s;
  }
  .generate:hover, .copy-btn:hover {
    background: #c6b142;
  }

  /* Output Box */
  .output {
    background: #333;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
    min-height: 22px;
    color: #e0ca51;
    font-weight: 600;
    word-break: break-word;
  }

  @media (max-width: 880px) {
    .container { width: 100%; max-width: 520px; }
  }
</style>
</head><body>

<!-- Toggle Buttons -->
<div class="toggle-buttons">
  <button id="fieldBtn" class="active">ุชูุฌููุงุช ุงูููุฏุงู</button>
  <button id="jobBtn">ุชูุฌููุงุช ุงูุชูุธูู</button>
  <button id="reportBtn">ุชูุงุฑูุฑ ุงูุนูููุงุช</button>
</div>

<!-- =======================
     Field Container (from first code)
     ======================= -->
<div class="container compact active" id="fieldContainer">
  <h1>๐ ุชูุฌููุงุช ุงูููุฏุงู ๐</h1>
  <h2>โ๏ธุงุฎุชุตุฑ ุงุณูู ุงูููุฏุงููโ๏ธ</h2>

  <input type="text" id="nameInputField" placeholder="ุงุฏุฎู ุงุณูู ูุซุงู (ุญูุฏ ุจู ุนุณูุฑ)">
  <input type="text" id="numberInputField" placeholder="ููุฏู ุงูููุฏุงูู ูุซุงู (G-110)">

  <select id="rankSelect">
    <option value="">ุงุฎุชุฑ ุฑุชุจุชู</option>
    <option value="ููู">ููู</option>
    <option value="ุงุดุฑุงู ููุทูู">ุงุดุฑุงู ููุทูู</option>
    <option value="ุงุดุฑุงู ููุทูู ูุชุฏุฑุจ">ุงุดุฑุงู ููุทูู ูุชุฏุฑุจ</option>
    <option value="ุงุดุฑุงู ููุฏุงูู">ุงุดุฑุงู ููุฏุงูู</option>
    <option value="ุงุดุฑุงู ุนุงู">ุงุดุฑุงู ุนุงู</option>
    <option value="ุทูุงุฑุฆ ูุฅููุงุฐ "> ุทูุงุฑุฆ ูุงููุงุฐ </option>
    <option value=" ูุณุคูู ุงูุฃุดุฑุงู "> ูุณุคูู ุงูุฃุดุฑุงู </option>
  </select>

  <select id="subRegion" style="display:none;">
    <option value="">ุงุฎุชุฑ ุชูุฌููู</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ููุณ">ุงุดุฑุงู ููุทูุฉ ููุณ</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ุณุงูุฏู">ุงุดุฑุงู ููุทูุฉ ุณุงูุฏู</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ุจูููุชู">ุงุดุฑุงู ููุทูุฉ ุจูููุชู</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ุจูููุชู + ุณุงูุฏู">ุงุดุฑุงู ููุทูุฉ ุจูููุชู + ุณุงูุฏู</option>
  </select>

  <select id="subRegionTrainee" style="display:none;">
    <option value="">ุงุฎุชุฑ ุชูุฌููู</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ููุณ ูุชุฏุฑุจ">ุงุดุฑุงู ููุทูุฉ ููุณ ูุชุฏุฑุจ</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ุณุงูุฏู ูุชุฏุฑุจ">ุงุดุฑุงู ููุทูุฉ ุณุงูุฏู ูุชุฏุฑุจ</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ุจูููุชู ูุชุฏุฑุจ">ุงุดุฑุงู ููุทูุฉ ุจูููุชู ูุชุฏุฑุจ</option>
    <option value="ุงุดุฑุงู ููุทูุฉ ุจูููุชู + ุณุงูุฏู ูุชุฏุฑุจ">ุงุดุฑุงู ููุทูุฉ ุจูููุชู + ุณุงูุฏู ูุชุฏุฑุจ</option>
  </select>

  <select id="regionNames" style="display:none;">
    <option value="">ุงุฎุชุฑ ุงุณู ุชูุฌููู</option>
    <option value="ููุณ">ููุณ</option>
    <option value="ุณุงูุฏู">ุณุงูุฏู</option>
    <option value="ุจูููุชู">ุจูููุชู</option>
    <option value="ุฌุฒูุฑุฉ">ุฌุฒูุฑุฉ</option>
    <option value="ุงูุนูููุงุช">ุงูุนูููุงุช</option>
    <option value="ูุงุฆุจ ุงูุนูููุงุช">ูุงุฆุจ ุงูุนูููุงุช</option>
    <option value="ูุฑูุฒ ุงูุงุชุตุงูุงุช">ูุฑูุฒ ุงูุงุชุตุงูุงุช</option>
  </select>

  <label><input type="checkbox" id="fleetToggle"> ูู ุชุฑูุฏ ุฅุถุงูุฉ ุฎุฏูุฉ ุงูุฃุณุทููุ</label>
  <select id="fleetBox" style="display:none;">
    <option value="">ุงุฎุชุฑ ุฎุฏูุฉ ุงูุงุณุทูู</option>
    <option value="ุงุณุทูู ููุณ">ุงุณุทูู ููุณ</option>
    <option value="ุงุณุทูู ุณุงูุฏู">ุงุณุทูู ุณุงูุฏู</option>
    <option value="ุงุณุทูู ุจูููุชู">ุงุณุทูู ุจูููุชู</option>
    <option value="ุงุณุทูู ุฌุฒูุฑุฉ">ุงุณุทูู ุฌุฒูุฑุฉ</option>
    <option value="ุงุณุทูู ูุชูุณุท ููุณ">ุงุณุทูู ูุชูุณุท ููุณ</option>
    <option value="ุงุณุทูู ูุชูุณุท ุณุงูุฏู">ุงุณุทูู ูุชูุณุท ุณุงูุฏู</option>
    <option value="ุงุณุทูู ูุชูุณุท ุจูููุชู">ุงุณุทูู ูุชูุณุท ุจูููุชู</option>
    <option value="ุงุณุทูู ูุชูุณุท ุฌุฒูุฑุฉ">ุงุณุทูู ูุชูุณุท ุฌุฒูุฑุฉ</option>
  </select>

  <label><input type="checkbox" id="minaTech"> ููู ูููุงุก</label>
  <label><input type="checkbox" id="masarat"> ูุณุงุฑุงุช ุงูุชุนุฏูู ู ุงูุชุฒููุฏ</label>
  <input type="text" id="masarInput" placeholder="ุงูุชุจ ุฑูู ุงููุณุงุฑ ููุท ูุซุงู (4)" style="display:none;">
  <label><input type="checkbox" id="controlUnit"> ูุญุฏุฉ ุชุญูู</label>
  <select id="controlOptions" style="display:none;">
    <option value="">ุงุฎุชุฑ ููุน ูุญุฏุฉ ุงูุชุญูู</option>
    <option value="ููู ูุฑูุฒ ุชุญูู">ููู ูุฑูุฒ ุชุญูู</option>
    <option value="ููู ุฎุฏูุงุช ุทุฑู">ููู ุฎุฏูุงุช ุทุฑู</option>
    <option value="ูุณุคูู ุชุญูู">ูุณุคูู ุชุญูู</option>
  </select>

  <!-- ููุฏ ุงููุนุชูุฏ -->
  <label><input type="checkbox" id="koodToggle"> ููุฏ ุงููุนุชูุฏ </label>
  <select id="koodOptions" style="display:none;">
    <option value="">ุงุฎุชุฑ ููุฏ ุงููุนุชูุฏ</option>
    <option value="CD">CD</option>
    <option value="CC">CC</option>
    <option value="CB">CB</option>
  </select>

  <button class="generate" onclick="generateResult()">๐ ุงุถุบุท ููุง ูุฃุธูุงุฑ ุงุณูู ๐</button>
  <div class="output" id="resultOutput"></div>
  <button class="copy-btn" onclick="copyText('resultOutput')">๐ ุงุถุบุท ููุง ูููุณุฎ ๐</button>
</div>

<!-- =======================
     Job Container (from first code)
     ======================= -->
<div class="container compact" id="jobContainer">
  <h1>๐ ุชูุฌููุงุช ุงูุชูุธูู๐ </h1>
  <h2>๐ุงุฎุชุตุฑ ุชูุฌููู ูู ุงูุชูุธูู ๐</h2>

  <input type="text" id="nameInput" placeholder="ุงุฏุฎู ุงุณูู ูุซุงู (ุญูุฏ ุจู ุนุณูุฑ)">
  <input type="text" id="numberInput" placeholder="ููุฏู ุงูููุฏุงูู ูุซุงู (G-110)">

  <label style="display:block; text-align:right; margin-top:6px">ุงุฎุชุงุฑ ุชูุฌููู ุญุณุจ ุงูุชูุฑูุฑ:</label>
  <select id="roleSelect">
    <option value="">ุงุฎุชุฑ ุชูุฌููู</option>
    <option>ูุงุฆุจ ูุฏูุฑ ูุณู ุดุคูู ุงูุชูุธูู</option>
    <option>ุงุดุฑุงู ุงูุชูุธูู</option>
    <option>ูุณุคูู ุงูููุงุจูุฉ 1</option>
    <option>ูุณุคูู ุงูููุงุจูุฉ 2</option>
    <option>ูุณุคูู ุงูููุงุจูุฉ 3</option>
    <option>ูุณุคูู ุงูููุงุจูุฉ 4</option>
    <option>ูุณุคูู ุงูููุงุจูุฉ 5</option>
    <option>ูุงุฆุจ ูุณุคูู ููุงุจูู 1</option>
    <option>ูุงุฆุจ ูุณุคูู ููุงุจูู 2</option>
    <option>ูุงุฆุจ ูุณุคูู ููุงุจูู 3</option>
    <option>ูุงุฆุจ ูุณุคูู ููุงุจูู 4</option>
    <option>ูุงุฆุจ ูุณุคูู ููุงุจูู 5</option>
    <option>ูุณุคูู ุชูุธูู 1</option>
    <option>ูุณุคูู ุชูุธูู 2</option>
    <option>ูุณุคูู ุชูุธูู 3</option>
    <option>ูุณุคูู ุชูุธูู 4</option>
    <option>ุชูุธูู 1</option>
    <option>ุชูุธูู 2</option>
    <option>ุชูุธูู 3</option>
    <option>ุชูุธูู 4</option>
    <option>ุจุงุต 1</option>
    <option>ุจุงุต 2</option>
    <option>ุจุงุต 3</option>
    <option>ุจุงุต 4</option>
  </select>

  <button class="generate" onclick="generateNickname()">๐ ุงุถุบุท ููุง ูุฃุธูุงุฑ ุงุณูู ๐</button>
  <div class="output" id="output"></div>
  <button class="copy-btn" onclick="copyText('output')">๐ ุงุถุบุท ููุง ูููุณุฎ ๐</button>
</div>

<!-- =======================
     Report Container (entire second file content)
     ======================= -->
<div class="container" id="reportContainer">
  <h1>ุชูุฑูุฑ ูุฑุงุฌ ุงููููุงูููู</h1>
<form id="reportForm" onsubmit="return false;">
    <div class="section-block">
      <label>ุฑูู ุงูุชูุฑูุฑ:</label>
      <input type="text" id="reportNumber" class="report-input" placeholder="ูุซุงู: 5" oninput="updatePreview()">
    </div>

    <div class="section-block">
      <div class="time-row">
        <label>ูู ุงูุณุงุนุฉ:</label>
        <input type="text" id="fromTime" class="time-input" placeholder="01:00" maxlength="5" oninput="updatePreview()">
        <select id="fromTimeAmPm" class="ampm-select" onchange="updatePreview()">
          <option value="ู">ู</option>
          <option value="ุต">ุต</option>
        </select>
      </div>
      <div class="time-row">
        <label>ุญุชู ุงูุณุงุนุฉ:</label>
        <input type="text" id="toTime" class="time-input" placeholder="02:00" maxlength="5" oninput="updatePreview()">
        <select id="toTimeAmPm" class="ampm-select" onchange="updatePreview()">
          <option value="ู">ู</option>
          <option value="ุต">ุต</option>
        </select>
      </div>
    </div>

    <!-- Multiple unit sections -->
    <div class="section-block">
      <div class="group-title">ููุงุฏุฉ ุงููุฑุงุฌ:</div>
      <div id="garageLead" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('garageLead')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ูุณุชุดุงุฑ ุงููุงุฆุฏ:</div>
      <div id="adviser" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('adviser')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุงููุดุฑู ุงูุนุงู:</div>
      <div id="generalSupervisor" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('generalSupervisor')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุงููุดุฑู ุงูููุฏุงูู:</div>
      <div id="fieldSupervisor" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('fieldSupervisor')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ูุดุฑููู ุงูููุงุทู:</div>
      <div id="areaSupervisors" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('areaSupervisors')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ูุดุฑููู ูุชุฏุฑุจูู :</div>
      <div id="normals" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('normals')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุงูุนูููุงุช:</div>
      <div id="operations" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('operations')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ูุงุฆุจ ุงูุนูููุงุช:</div>
      <div id="operationsDeputy" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('operationsDeputy')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ูุฑูุฒ ุงูุงุชุตุงูุงุช:</div>
      <div id="communicationCenter" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('communicationCenter')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุงูุณูุฏุงุช ู ุงููุนุชูุฏูู:</div>
      <div id="ladiesAndAuthorized" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('ladiesAndAuthorized')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุงูุฌุฒูุฑุฉ:</div>
      <div id="gezera" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('gezera')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุจูููุชู:</div>
      <div id="bolito" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('bolito')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุณุงูุฏู:</div>
      <div id="sandy" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('sandy')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ููุณ:</div>
      <div id="los" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('los')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ูููุงุก ููุณ:</div>
      <div id="losPort" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('losPort')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ูููุงุก ุจูููุชู:</div>
      <div id="bolitoPort" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('bolitoPort')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุฎุฏูุงุช ุงูุงุณุทูู:</div>
      <div class="fleet-count">
        ุนุฏุฏ:
        <select id="fleetCount">
          <option value="00">00</option>
          <option value="01">01</option>
          <option value="02">02</option>
          <option value="03">03</option>
          <option value="04">04</option>
          <option value="05">05</option>
          <option value="06">06</option>
          <option value="07">07</option>
          <option value="08">08</option>
          <option value="09">09</option>
          <option value="10">10</option>
        </select>
      </div>
    </div>

    <div class="section-block">
      <div class="group-title">ุชูุธูู ุณูุฑ ุชุนุฏูู ู ุชุฒููุฏ:</div>
      <div id="trafficOrg" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('trafficOrg')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div class="section-block">
      <div class="group-title">ุงูุจุญุซ ูุงูุฅููุงุฐ:</div>
      <div id="rescue" class="units-list"></div>
      <button type="button" class="add-unit-btn" onclick="addUnit('rescue')">ุฅุถุงูุฉ ูุญุฏุฉ</button>
    </div>

    <div style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap;">
      <button type="button" onclick="exportReport()">ุชุญุฏูุซ ุงูุชูุฑูุฑ</button>
      <button type="button" onclick="copyReport()">ูุณุฎ ุงูุชูุฑูุฑ</button>
    </div>
  </form>

  <div class="export" style="margin-top:12px;">
    <h2 style="color:#FFD700; text-align:center;">ูููุฐุฌ ุงูุชูุฑูุฑ:</h2>
    <pre id="reportPreview" class="report-output"></pre>
  </div>
  </form>

  <div class="export" style="margin-top:12px;">
    <h2 style="color:var(--gold); text-align:center;">ูููุฐุฌ ุงูุชูุฑูุฑ:</h2>
    <pre id="reportPreview" class="report-output"></pre>
  </div>
</div>

<!-- =======================
     JavaScript: merged and unified
     ======================= -->
<script>
/* --------------------------
   Shared helpers (from first file)
   -------------------------- */
function isValidSelection(val) {
  return val && String(val).trim() !== "" && !String(val).trim().startsWith("ุงุฎุชุฑ");
}

function copyText(id) {
  const el = document.getElementById(id);
  if (!el) return;
  const text = el.innerText || el.textContent || "";
  if (!text.trim()) return;
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).catch(()=>{});
  } else {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); } catch(e){}
    ta.remove();
  }
}

/* Bracket helpers */
function parseBracketed(str){
  if (!str) return null;
  const m = /^\s*\[\s*([^\|\]\s]+)\s*\|\s*([^\]]*?)\s*\]\s*$/.exec(str);
  if (!m) return null;
  return { code: m[1], part: m[2] };
}
function makeBracketed(code, part){
  return `[ ${code} | ${part} ]`;
}
function formatNumberPart(s){
  const digits = String(s || "").replace(/[^0-9]/g, "");
  return digits ? ("G-" + digits) : "";
}

/* --------------------------
   Tab switching (extended)
   -------------------------- */
document.getElementById("fieldBtn").onclick = function(){
  document.getElementById("fieldContainer").classList.add("active");
  document.getElementById("jobContainer").classList.remove("active");
  document.getElementById("reportContainer").classList.remove("active");
  this.classList.add("active");
  document.getElementById("jobBtn").classList.remove("active");
  document.getElementById("reportBtn").classList.remove("active");
};
document.getElementById("jobBtn").onclick = function(){
  document.getElementById("jobContainer").classList.add("active");
  document.getElementById("fieldContainer").classList.remove("active");
  document.getElementById("reportContainer").classList.remove("active");
  this.classList.add("active");
  document.getElementById("fieldBtn").classList.remove("active");
  document.getElementById("reportBtn").classList.remove("active");
};
document.getElementById("reportBtn").onclick = function(){
  document.getElementById("reportContainer").classList.add("active");
  document.getElementById("fieldContainer").classList.remove("active");
  document.getElementById("jobContainer").classList.remove("active");
  this.classList.add("active");
  document.getElementById("fieldBtn").classList.remove("active");
  document.getElementById("jobBtn").classList.remove("active");
};

/* --------------------------
   Field & Job setup (from first code)
   -------------------------- */
document.addEventListener("DOMContentLoaded", function () {
  /* Field elements */
  const rankSelect = document.getElementById("rankSelect");
  const fleetToggle = document.getElementById("fleetToggle");
  const fleetBox = document.getElementById("fleetBox");
  const minaTech = document.getElementById("minaTech");
  const masarat = document.getElementById("masarat");
  const masarInput = document.getElementById("masarInput");
  const controlUnit = document.getElementById("controlUnit");
  const controlOptions = document.getElementById("controlOptions");
  const koodToggle = document.getElementById("koodToggle");
  const koodOptions = document.getElementById("koodOptions");
  const numberField = document.getElementById("numberInputField");
  const numberFieldJob = document.getElementById("numberInput");

  /* Rank logic */
  if (rankSelect) {
    rankSelect.onchange = function () {
      const v = this.value;
      document.getElementById("subRegion").style.display = (v === "ุงุดุฑุงู ููุทูู") ? "block" : "none";
      document.getElementById("subRegionTrainee").style.display = (v === "ุงุดุฑุงู ููุทูู ูุชุฏุฑุจ") ? "block" : "none";
      document.getElementById("regionNames").style.display = (v === "ููู") ? "block" : "none";
    };
  }

  /* Fleet toggle */
  if (fleetToggle && fleetBox) {
    fleetToggle.onchange = function () {
      fleetBox.style.display = this.checked ? "block" : "none";
    };
    fleetBox.style.display = fleetToggle.checked ? "block" : "none";
  }

  /* MinaTech & Masarat mutual exclusion ONLY between themselves (not affecting kood) */
  if (minaTech) {
    minaTech.onchange = function () {
      if (this.checked && masarat) {
        masarat.checked = false;
        if (masarInput) masarInput.style.display = "none";
      }
    };
  }
  if (masarat) {
    masarat.onchange = function () {
      if (masarInput) masarInput.style.display = this.checked ? "block" : "none";
      if (this.checked && minaTech) minaTech.checked = false;
    };
    if (masarInput) masarInput.style.display = masarat.checked ? "block" : "none";
  }

  /* Control unit toggle */
  if (controlUnit && controlOptions) {
    controlUnit.onchange = function () {
      controlOptions.style.display = this.checked ? "block" : "none";
    };
    controlOptions.style.display = controlUnit.checked ? "block" : "none";
  }

  /* Kood independent toggle */
  if (koodToggle && koodOptions && numberField) {
    koodToggle.onchange = function () {
      koodOptions.style.display = this.checked ? "block" : "none";
    };
    koodOptions.onchange = function () {
      const val = this.value;
      if (!val) return;
      const parsedNow = parseBracketed(numberField.value);
      const rawPart = parsedNow ? parsedNow.part : numberField.value;
      const formattedPart = formatNumberPart(rawPart) || "G-";
      numberField.value = makeBracketed(val, formattedPart);
    };
    koodOptions.style.display = koodToggle.checked ? "block" : "none";
  }

  /* Format number fields */
  function handleNumberFieldInput(el) {
    const parsed = parseBracketed(el.value);
    if (parsed) {
      const afterPipe = el.value.replace(/^\s*\[\s*[^\|\]\s]+\s*\|\s*/,'').replace(/\s*\]\s*$/,'');
      el.value = makeBracketed(parsed.code, formatNumberPart(afterPipe));
    } else {
      el.value = formatNumberPart(el.value);
    }
  }
  if (numberField) {
    numberField.oninput = function () { handleNumberFieldInput(this); };
    numberField.onpaste = function () { setTimeout(()=>handleNumberFieldInput(this), 0); };
  }
  if (numberFieldJob) {
    numberFieldJob.oninput = function () { this.value = formatNumberPart(this.value); };
    numberFieldJob.onpaste = function () { setTimeout(()=> { numberFieldJob.value = formatNumberPart(numberFieldJob.value); }, 0); };
  }

  /* Initialize Report section elements (from second file) */
  // define addUnit/getUnits etc here or after - they exist below, so call the initial populate there
});

/* --------------------------
   generateResult (field) & generateNickname (job)
   (from first code)
   -------------------------- */
function generateResult() {
  const name = (document.getElementById("nameInputField").value || "").trim();
  const number = (document.getElementById("numberInputField").value || "").trim();
  const rank = document.getElementById("rankSelect").value;
  const subRegion = document.getElementById("subRegion").value;
  const subRegionTrainee = document.getElementById("subRegionTrainee").value;
  const regionName = document.getElementById("regionNames").value;
  const fleetChecked = document.getElementById("fleetToggle").checked;
  const fleetVal = document.getElementById("fleetBox").value;
  const minaTechChecked = document.getElementById("minaTech").checked;
  const masaratChecked = document.getElementById("masarat").checked;
  const masarVal = (document.getElementById("masarInput").value || "").trim();
  const controlChecked = document.getElementById("controlUnit").checked;
  const controlVal = document.getElementById("controlOptions").value;
  const koodChecked = document.getElementById("koodToggle").checked;
  const koodVal = document.getElementById("koodOptions").value;

  if (!name || !number) {
    document.getElementById("resultOutput").innerText = "ูุฑุฌู ููุก ุงูุงุณู ูุงูููุฏ.";
    return;
  }

  const parts = [];
  if (!minaTechChecked && !masaratChecked) parts.push(name);
  parts.push(number);

  if (minaTechChecked) {
    parts.push("ููู ูููุงุก");
  } else if (masaratChecked && masarVal) {
    parts.push("ูุณุงุฑ " + masarVal);
  } else {
    if (isValidSelection(rank)) {
      if (rank === "ุงุดุฑุงู ููุทูู" && isValidSelection(subRegion)) {
        parts.push(subRegion);
      } else if (rank === "ุงุดุฑุงู ููุทูู ูุชุฏุฑุจ" && isValidSelection(subRegionTrainee)) {
        parts.push(subRegionTrainee);
      } else if (rank === "ููู" && isValidSelection(regionName)) {
        parts.push(regionName);
      } else if (rank !== "ููู") {
        parts.push(rank);
      }
    }
    if (fleetChecked && isValidSelection(fleetVal)) parts.push(fleetVal);
    if (controlChecked && isValidSelection(controlVal)) parts.push(controlVal);
  }

  // Kood is now completely independent โ user can select it with anything else
  if (koodChecked && isValidSelection(koodVal)) {
    const parsedNumber = parseBracketed(number);
    if (!(parsedNumber && parsedNumber.code === koodVal)) {
      parts.push("ููุฏ " + koodVal);
    }
  }

  document.getElementById("resultOutput").innerText = parts.join(" | ");
}

function generateNickname() {
  const name = (document.getElementById("nameInput").value || "").trim();
  const number = (document.getElementById("numberInput").value || "").trim();
  const role = document.getElementById("roleSelect").value;

  if (!name || !number || !isValidSelection(role)) {
    document.getElementById("output").innerText = "ูุฑุฌู ููุก ุฌููุน ุงูุญููู.";
    return;
  }

  document.getElementById("output").innerText = [name, number, role].join(" | ");
}

/* --------------------------
   Report script (from second file)
   -------------------------- */
function addUnit(areaId) {
  const parent = document.getElementById(areaId);
  if (!parent) return;
  const unitDiv = document.createElement('div');
  unitDiv.className = "unit-row";

  const prefixSelect = document.createElement('select');
  prefixSelect.className = 'unit-prefix';
  [
    {v: 'G', t: 'G'},
    {v: 'H', t: 'H'},
    {v: 'E', t: 'E'},
    {v: 'P', t: 'P'},
    {v: 'A', t: 'A'},
    {v: 'F', t: 'F'},
    {v: 'M', t: 'M'},
    {v: 'R', t: 'R'},
    {v: 'ูุง ููุฌุฏ', t: 'ูุง ููุฌุฏ'}
  ].forEach(optObj=>{
    const opt = document.createElement('option');
    opt.value = optObj.v;
    opt.textContent = optObj.t;
    prefixSelect.appendChild(opt);
  });

  prefixSelect.onchange = function() {
    if(this.value === 'ูุง ููุฌุฏ') {
      codeInput.value = '';
      codeInput.disabled = true;
      codeInput.classList.add('disabled-input');
    } else {
      codeInput.disabled = false;
      codeInput.classList.remove('disabled-input');
    }
    updatePreview();
  };

  const codeInput = document.createElement('input');
  codeInput.type = 'text';
  codeInput.placeholder = 'ุฑูู ุงููุญุฏุฉ (ูุซุงู: 012)';
  codeInput.className = 'unit-code';
  codeInput.oninput = updatePreview;

  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.className = 'remove-btn';
  removeBtn.textContent = 'ร';
  removeBtn.onclick = () => { parent.removeChild(unitDiv); updatePreview(); };

  unitDiv.appendChild(prefixSelect);
  unitDiv.appendChild(codeInput);
  unitDiv.appendChild(removeBtn);
  parent.appendChild(unitDiv);

  updatePreview();
}

function getUnits(areaId) {
  const parent = document.getElementById(areaId);
  const units = [];
  if (!parent) return units;
  parent.querySelectorAll('.unit-row').forEach(unitRow => {
    const prefix = unitRow.querySelector('.unit-prefix').value;
    const code = (unitRow.querySelector('.unit-code').value || "").trim();
    if(areaId === 'sandy' || areaId === 'bolito' || areaId === 'gezera' || areaId === 'los') {
      if(prefix !== 'ูุง ููุฌุฏ' && code) {
        units.push(`${prefix}-${code}`); // ุงูุญุฑู ูุฑูู ุงููุญุฏุฉ ุจุฏูู @
      } else if (code) {
        units.push(code); // ูู ูููุด prefix
      }
    } else {
      if(prefix !== 'ูุง ููุฌุฏ' && code) {
        units.push(`@${prefix}-${code}`);
      } else if(code) {
        units.push(code);
      }
    }
  });
  return units;
}

function generateLine(label, arr, emptyLabel, newLineAfterLabel = false) {
  let filteredArr = arr.filter(v => v);
  let out = newLineAfterLabel ? `${label}\n` : `${label} `;
  if (filteredArr.length) {
    out += filteredArr.join('\n');
  } else {
    out += emptyLabel || "ูุงููุฌุฏ";
  }
  out += '\n\n';
  return out;
}

function generateReport() {
  const reportNumber = (document.getElementById('reportNumber') ? document.getElementById('reportNumber').value.trim() : "");
  const fromTime = (document.getElementById('fromTime') ? document.getElementById('fromTime').value.trim() : "");
  const fromTimeAmPm = (document.getElementById('fromTimeAmPm') ? document.getElementById('fromTimeAmPm').value : "");
  const toTime = (document.getElementById('toTime') ? document.getElementById('toTime').value.trim() : "");
  const toTimeAmPm = (document.getElementById('toTimeAmPm') ? document.getElementById('toTimeAmPm').value : "");
  const fleetCount = (document.getElementById('fleetCount') ? document.getElementById('fleetCount').value : "00");

  let report = `ุชู ุงุณุชูุงู ุงูุชูุฑูุฑ ุงูููุฏุงูู ูููุฑุงุฌ ุงููููุงูููู\n\n`;
  report += `ุชูุฑูุฑ ุฑูู ( ${reportNumber} )\n\n`;
  report += `ูู ุงูุณุงุนู ${fromTime} (${fromTimeAmPm})\nุญุชู ุงูุณุงุนู ${toTime} (${toTimeAmPm})\n\n`;

  report += generateLine("ููุงุฏุฉ ุงููุฑุงุฌ:", getUnits('garageLead'));
  report += generateLine("ูุณุชุดุงุฑ ุงููุงุฆุฏ:", getUnits('adviser'));
  report += generateLine("ุงููุดุฑู ุงูุนุงู:", getUnits('generalSupervisor'));
  report += generateLine("ุงููุดุฑู ุงูููุฏุงูู:", getUnits('fieldSupervisor'));
  report += generateLine("ูุดุฑููู ุงูููุงุทู:", getUnits('areaSupervisors'));
  report += generateLine("ูุดุฑููู ูุชุฏุฑุจูู:", getUnits('normals'));
  report += generateLine("ุงูุนูููุงุช:", getUnits('operations'));
  report += generateLine("ูุงุฆุจ ุงูุนูููุงุช:", getUnits('operationsDeputy'));
  report += generateLine("ูุฑูุฒ ุงูุงุชุตุงูุงุช:", getUnits('communicationCenter'));
  report += generateLine("ุงูุณูุฏุงุช ู ุงููุนุชูุฏูู:", getUnits('ladiesAndAuthorized'));
  report += generateLine("ุงูุฌุฒูุฑุฉ:", getUnits('gezera'), null, true);
  report += generateLine("ุจูููุชู:", getUnits('bolito'), null, true);
  report += generateLine("ุณุงูุฏู:", getUnits('sandy'), null, true);
  report += generateLine("ููุณ:", getUnits('los'), null, true);
  report += `ุฎุฏูุงุช ุงูุงุณุทูู :\nุนุฏุฏ / ${fleetCount}\n\n`;
  report += generateLine("ูููุงุก ููุณ:", getUnits('losPort'));
  report += generateLine("ูููุงุก ุจูููุชู:", getUnits('bolitoPort'));
  report += generateLine("ุชูุธูู ุณูุฑ ุชุนุฏูู ู ุชุฒููุฏ:", getUnits('trafficOrg'));
  report += generateLine("ุงูุจุญุซ ูุงูุฅููุงุฐ:", getUnits('rescue'));

  return report;
}

function updatePreview() {
  const el = document.getElementById('reportPreview');
  if (!el) return;
  el.textContent = generateReport();
}

function copyReport() {
  const reportText = document.getElementById('reportPreview').textContent;
  if (!reportText) return alert("ูุง ููุฌุฏ ุชูุฑูุฑ ูููุณุฎ.");
  navigator.clipboard.writeText(reportText).then(() => {
    alert("ุชู ูุณุฎ ุงูุชูุฑูุฑ ุจูุฌุงุญ โ");
  }).catch(err => {
    alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงููุณุฎ โ");
    console.error(err);
  });
}

function exportReport() {
  const report = generateReport();
  document.getElementById('reportPreview').textContent = report;
  // Note: original file created export link/file - omitted by original author; kept display update only
}

/* --------------------------
   Initialize report units and listeners (run after definitions)
   -------------------------- */
(function initReportSection(){
  // the sections that should have an initial "unit row" appended:
  const sections = [
    'garageLead','adviser','generalSupervisor','fieldSupervisor',
    'areaSupervisors','operations','operationsDeputy','communicationCenter','ladiesAndAuthorized',
    'rescue','trafficOrg','bolitoPort','losPort','sandy','bolito','normals','gezera','los'
  ];
  // add one unit row to each section (like the original)
  sections.forEach(id => {
    // only add if the element exists
    const el = document.getElementById(id);
    if (el) addUnit(id);
  });

  // wire up listeners for inputs used by updatePreview
  const idsToWatch = ['fleetCount','fromTimeAmPm','toTimeAmPm','reportNumber','fromTime','toTime'];
  idsToWatch.forEach(id=>{
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener('change', updatePreview);
    el.addEventListener('input', updatePreview);
  });

  // initial preview
  updatePreview();
})();

</script>
</body>
</html>




